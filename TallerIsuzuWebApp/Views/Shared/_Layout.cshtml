@using System.Security.Claims
@{
    var userClaims = User.Claims;
    var userRole = userClaims.FirstOrDefault(c => c.Type == ClaimTypes.Role)?.Value ?? "Guest";
    var userJobTitle = userClaims.FirstOrDefault(c => c.Type == "JobTitle")?.Value ?? "None";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - TallerIsuzuWebApp</title>

    <link rel="stylesheet" href="~/css/styles.css" asp-append-version="true">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</head>
<body>
    <div class="navigation">
        <ul>
            <li>
                <a href="@Url.Action("Index", "Dashboard")">
                    <span class="icon"></span>
                    <span class="title">Taller Isuzu</span>
                </a>
            </li>
            @if (userRole == "User" || userJobTitle == "Supervisor" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="/CLSL/VerLlamadasAsignadas">
                        <span class="icon"><ion-icon name="call-outline"></ion-icon></span>
                        <span class="title">Historico de llamadas</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("Index", "Account")">
                        <span class="icon"><ion-icon name="people-outline"></ion-icon></span>
                        <span class="title">Administrar Usuarios</span>
                    </a>
                </li>
            }
            @if (userJobTitle == "Supervisor" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("Reports", "Supervisor")">
                        <span class="icon"><ion-icon name="analytics-outline"></ion-icon></span>
                        <span class="title">Reportes</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("ListadoCompleto", "CLSL")">
                        <span class="icon"><ion-icon name="list-outline"></ion-icon></span>
                        <span class="title">Listado de Llamadas</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Supervisor" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("PendientesDeAsignar", "CLSL")">
                        <span class="icon"><ion-icon name="list-outline"></ion-icon></span>
                        <span class="title">Asignar llamadas</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Produccion" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("PendientesDeAsignarPrioritarias", "CLSL")">
                        <span class="icon"><ion-icon name="list-outline"></ion-icon></span>
                        <span class="title">Asignar llamadas prioritaria</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Supervisor" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("VerLlamadasAsignadas", "CLSL")">
                        <span class="icon"><ion-icon name="list-outline"></ion-icon></span>
                        <span class="title">Llamadas asignadas</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("ObtenerLlamadasComisiones", "CLSL")">
                        <span class="icon"><ion-icon name="list-outline"></ion-icon></span>
                        <span class="title">Generar pre comisiones</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("AjusteComisiones", "CLSL")">
                        <span class="icon"><ion-icon name="cash-outline"></ion-icon></span>
                        <span class="title">Ajuste de Comisiones</span>
                    </a>
                </li>
            }
            @if (userRole == "Admin" || userRole == "Desarrollador" || userJobTitle == "Desarrollador")
            {
                <li>
                    <a href="@Url.Action("GestionManoDeObra", "CLSL")">
                        <span class="icon"><ion-icon name="construct-outline"></ion-icon></span>
                        <span class="title">Códigos de mano de obra</span>
                    </a>
                </li>
            }
        </ul>
    </div>

    <div class="main p-2 ">
        <div class="topbar">
            <div class="toggle">
                <ion-icon name="menu-outline"></ion-icon>
            </div>

            <div class="search"><label></label></div>

            <div class="d-flex align-items-center gap-3 ms-auto">
                <!-- Info del usuario -->
                <div class="text-end d-none d-md-block">
                    <div class="fw-semibold">@User.Identity.Name</div>
                    <small class="text-muted">@userRole (@userJobTitle)</small>
                </div>

                <!-- Avatar (opcional) -->
                <div class="user">
                    <img src="/img/user.png" alt="User">
                </div>

                <!-- Botón Cerrar sesión -->
                <form asp-controller="Account" asp-action="Logout" method="post" class="m-0 p-0">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger btn-sm d-flex align-items-center px-3">
                        <ion-icon name="log-out-outline" class="me-1"></ion-icon>
                        Cerrar sesión
                    </button>
                </form>
            </div>
        </div>

        <div class="p-2" style="padding-left: 25px;">@RenderBody()</div>
    </div>

    <footer>
        <p>&copy; 2024 TallerIsuzuWebApp</p>
    </footer>

    <!-- JavaScript base (jQuery primero, luego Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Tu script global -->
    <script src="~/js/scripts.js" asp-append-version="true"></script>

    <!-- Sección opcional para scripts por vista -->
    @RenderSection("Scripts", required: false)
</body>
</html>
